<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados de Evaluaci√≥n - Jarvis Analyst</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-dark {
            background: #343a40;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .terminal-output {
            margin: 20px 0;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }
        
        .terminal-output h4 {
            margin-bottom: 10px;
            color: #495057;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .code-block.error {
            background: #742a2a;
            color: #fed7d7;
        }
        
        .test-details {
            margin: 20px 0;
        }
        
        .test-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
            gap: 15px;
        }
        
        .test-status {
            font-size: 18px;
            min-width: 30px;
        }
        
        .test-name {
            flex: 1;
            font-weight: 500;
        }
        
        .test-time {
            color: #6c757d;
            font-size: 14px;
        }
        
        .evaluation-details {
            margin: 20px 0;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .content {
            padding: 30px;
        }
        
        .test-results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-results-table th {
            background: #f8f9fa;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }
        
        .test-results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .test-results-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-ready {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-unknown {
            background: #e2e3e5;
            color: #383d41;
        }
        
        .test-count {
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .test-count.passed {
            background: #d4edda;
            color: #155724;
        }
        
        .test-count.failed {
            background: #f8d7da;
            color: #721c24;
        }
        
        .test-count.skipped {
            background: #fff3cd;
            color: #856404;
        }
        
        .category-stats {
            margin: 15px 0;
        }
        
        .category-section {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #17a2b8;
        }
        
        .category-section h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 1.1em;
        }
        
        .category-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        
        .api-status-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        
        .api-status-section h4 {
            margin: 0 0 15px 0;
            color: #495057;
            font-size: 1.2em;
        }
        
        .api-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .api-status-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .api-status-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .api-status-item.working {
            border-left: 4px solid #28a745;
        }
        
        .api-status-item.error {
            border-left: 4px solid #dc3545;
        }
        
        .api-status-item.checking {
            border-left: 4px solid #ffc107;
        }
        
        .api-icon {
            font-size: 24px;
            margin-right: 12px;
        }
        
        .api-info {
            flex: 1;
        }
        
        .api-name {
            font-weight: 600;
            color: #495057;
            margin-bottom: 4px;
        }
        
        .api-status-text {
            font-size: 14px;
            color: #6c757d;
        }
        
        .api-indicator {
            font-size: 20px;
            margin-left: 10px;
        }
        
        .category-tests {
            margin: 20px 0;
            padding: 15px;
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .category-tests h5 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 1em;
            font-weight: 600;
        }
        
        .test-list {
            margin-top: 10px;
        }
        
        .test-item.passed {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .test-item.failed {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .test-item.skipped {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .test-full-name {
            font-size: 12px;
            color: #6c757d;
            margin-left: 10px;
            font-style: italic;
        }
        
        .test-item {
            margin: 6px 0;
            padding: 12px;
            border-radius: 6px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            background: #f8f9fa;
            transition: all 0.2s ease;
        }
        
        .test-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-item.passed {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }
        
        .test-item.failed {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        
        .test-item.skipped {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .test-status {
            font-size: 1.2em;
            min-width: 30px;
            display: flex;
            align-items: center;
        }
        
        .test-details {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .test-name {
            font-weight: 600;
            margin-bottom: 4px;
            color: #333;
            font-size: 1em;
        }
        
        .test-full-name {
            color: #666;
            font-size: 0.85em;
            margin-bottom: 4px;
            word-break: break-all;
        }
        
        .test-skip-reason {
            color: #856404;
            font-size: 0.8em;
            font-style: italic;
            background: rgba(255, 193, 7, 0.2);
            padding: 2px 6px;
            border-radius: 3px;
            margin-top: 4px;
            display: inline-block;
        }
        
        .test-summary {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        
        .test-summary h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        .summary-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stat-item {
            font-size: 14px;
            color: #6c757d;
        }
        
        .test-details {
            margin-top: 20px;
        }
        
        .test-details h4 {
            margin: 0 0 15px 0;
            color: #495057;
        }
        
        .test-details-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-details-table th {
            background: #e9ecef;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }
        
        .test-details-table td {
            padding: 10px 15px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .test-row.passed {
            background: #f8fff8;
        }
        
        .test-row.failed {
            background: #fff5f5;
        }
        
        .test-row:hover {
            background: #f0f0f0 !important;
        }
        
        .test-name {
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        
        .test-status.passed {
            color: #28a745;
            font-weight: bold;
        }
        
        .test-status.failed {
            color: #dc3545;
            font-weight: bold;
        }
        
        .no-details {
            padding: 20px;
            text-align: center;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .no-details p {
            margin: 0;
            color: #6c757d;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #f5c6cb;
        }
        
        .result-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #007bff;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .result-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .result-timestamp {
            color: #666;
            font-size: 0.9em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .ranking {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .ranking h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .ranking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .ranking-item:last-child {
            border-bottom: none;
        }
        
        .ranking-position {
            font-weight: bold;
            color: #007bff;
        }
        
        .ranking-score {
            font-weight: 600;
            color: #28a745;
        }
        
        .json-viewer {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            transform: scale(1.1);
            background: #0056b3;
        }
        
        /* Estilos para evaluaciones detalladas */
        .evaluation-summary {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .eval-timestamp, .eval-id {
            font-weight: 600;
            color: #495057;
        }
        
        .ranking-item.success {
            border-left: 4px solid #28a745;
            background: #d4edda;
        }
        
        .ranking-item.warning {
            border-left: 4px solid #ffc107;
            background: #fff3cd;
        }
        
        .ranking-item.danger {
            border-left: 4px solid #dc3545;
            background: #f8d7da;
        }
        
        .ranking-position {
            font-size: 1.2em;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .ranking-info {
            flex-grow: 1;
        }
        
        .score {
            font-size: 1.1em;
            font-weight: 600;
            color: #495057;
        }
        
        .alert-danger {
            border: 2px solid #dc3545;
            background: #f8d7da;
        }
        
        .problem-analysis {
            margin: 15px 0;
        }
        
        .problem-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .problem-description {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
        }
        
        .problem-description h4 {
            color: #dc3545;
            margin-bottom: 10px;
        }
        
        .problem-description p {
            margin: 8px 0;
            line-height: 1.5;
        }
        
        .category-summary {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        
        .category-stats {
            display: flex;
            gap: 15px;
            font-weight: 600;
        }
        
        .prompts-details {
            margin-top: 15px;
        }
        
        .prompt-item {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin: 10px 0;
            padding: 15px;
            background: white;
        }
        
        .prompt-item.success {
            border-left: 4px solid #28a745;
        }
        
        .prompt-item.warning {
            border-left: 4px solid #ffc107;
        }
        
        .prompt-item.danger {
            border-left: 4px solid #dc3545;
        }
        
        .prompt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .prompt-title {
            font-weight: bold;
            color: #495057;
        }
        
        .prompt-score {
            font-weight: bold;
            font-size: 1.1em;
            padding: 4px 8px;
            border-radius: 4px;
            background: #e9ecef;
        }
        
        .prompt-question {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #007bff;
        }
        
        .prompt-response {
            margin: 10px 0;
        }
        
        .response-text {
            background: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 12px;
            margin: 8px 0;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .response-text.error-response {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        
        .error-badge {
            background: #dc3545;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 8px;
        }
        
        .prompt-metrics {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #dee2e6;
        }
        
        .metrics-grid {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }
        
        .metric-item {
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .metric-item span:first-child {
            font-weight: 600;
        }
        
        .criteria-details {
            margin-top: 10px;
        }
        
        .criterion {
            display: inline-block;
            margin: 2px 5px;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .criterion.met {
            background: #d4edda;
            color: #155724;
        }
        
        .criterion.not-met {
            background: #f8d7da;
            color: #721c24;
        }
        
        .btn-sm {
            padding: 4px 8px;
            font-size: 0.8em;
            border-radius: 4px;
            border: 1px solid #007bff;
            background: #007bff;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-sm:hover {
            background: #0056b3;
            border-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Resultados de Evaluaci√≥n</h1>
            <p>Sistema de An√°lisis y Evaluaci√≥n Autom√°tica</p>
        </div>
        
        <div class="nav-buttons">
            <button class="btn btn-primary" onclick="loadLatestResults()">√öltimos Resultados</button>
            <button class="btn btn-secondary" onclick="loadTests()">Tests</button>
            <button class="btn btn-dark" onclick="loadEvaluations()">Evaluaciones</button>
        </div>
        <div class="nav-buttons">
            <button class="btn btn-success" onclick="runTests()">Ejecutar Tests</button>
            <button class="btn btn-info" onclick="runEvaluations()">Ejecutar Evaluaciones</button>
            <button class="btn btn-success" onclick="toggleAutoRefresh()" id="autoRefreshBtn">Activar Auto-Refresh</button>
            <a href="/" class="btn btn-dark">Volver al Chat</a>
        </div>
        
        <div class="content" id="content">
            <div class="loading">Cargando resultados...</div>
        </div>
    </div>
    
    <button class="refresh-btn" onclick="refreshData()" title="Actualizar datos">üîÑ</button>
    
    <script>
        let currentView = 'latest';
        let currentData = null;
        let autoRefreshEnabled = false;
        let autoRefreshInterval = null;
        
        async function fetchData(endpoint) {
            try {
                const response = await fetch(`/api/results/${endpoint}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching data:', error);
                throw error;
            }
        }
        
        function showError(message) {
            document.getElementById('content').innerHTML = `
                <div class="error">
                    <h3>Error</h3>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="refreshData()">Reintentar</button>
                </div>
            `;
        }
        
        function showLoading() {
            document.getElementById('content').innerHTML = '<div class="loading">Cargando resultados...</div>';
        }
        
        async function loadLatestResults() {
            currentView = 'latest';
            showLoading();
            try {
                // Cargar √∫ltimos resultados de evaluaciones
                const evaluationData = await fetchData('latest');
                
                // Intentar obtener informaci√≥n de tests recientes
                let testData = null;
                try {
                    const response = await fetch('/api/results/test-status');
                    if (response.ok) {
                        testData = await response.json();
                    }
                } catch (e) {
                    console.log('No hay datos de tests disponibles');
                }
                
                displayLatestResults(evaluationData, testData);
            } catch (error) {
                showError(`No se pudieron cargar los √∫ltimos resultados: ${error.message}`);
            }
        }
        
        async function loadTests() {
            currentView = 'tests';
            showLoading();
            try {
                // Cargar estado actual de tests
                const testStatusResponse = await fetch('/api/results/test-status');
                if (testStatusResponse.ok) {
                    const testStatus = await testStatusResponse.json();
                    displayCurrentTestStatus(testStatus);
                } else {
                    // Fallback a la funci√≥n original
                    const data = await fetchData('list');
                    currentData = data;
                    displayTestResults(data);
                }
            } catch (error) {
                showError(`No se pudo cargar los tests: ${error.message}`);
            }
        }
        
        async function loadEvaluations() {
            currentView = 'evaluations';
            showLoading();
            try {
                const data = await fetchData('list');
                currentData = data;
                displayEvaluationResults(data);
            } catch (error) {
                showError(`No se pudo cargar las evaluaciones: ${error.message}`);
            }
        }
        
        async function runTests() {
            showLoading();
            document.getElementById('content').innerHTML = `
                <div class="result-card">
                    <h2>Ejecutando Tests...</h2>
                    <p>Por favor espera mientras se ejecutan todos los tests del sistema.</p>
                    <div class="loading-spinner"></div>
                </div>
            `;
            
            try {
                console.log('Iniciando petici√≥n a /api/results/run-tests');
                
                // Crear un AbortController para timeout
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 300000); // 5 minutos timeout
                
                const response = await fetch('/api/results/run-tests', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                console.log('Respuesta recibida:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Error en respuesta:', errorText);
                    throw new Error(`Error ${response.status}: ${errorText}`);
                }
                
                console.log('Parseando JSON...');
                const result = await response.json();
                console.log('JSON parseado exitosamente, mostrando resultados');
                
                displayTestExecutionResults(result);
            } catch (error) {
                console.error('Error ejecutando tests:', error);
                console.error('Stack trace:', error.stack);
                showError(`Error al ejecutar tests: ${error.message}`);
            }
        }
        
        async function runEvaluations() {
            showLoading();
            document.getElementById('content').innerHTML = `
                <div class="result-card">
                    <h2>Ejecutando Evaluaciones...</h2>
                    <p>Por favor espera mientras se ejecutan las evaluaciones autom√°ticas.</p>
                    <div class="loading-spinner"></div>
                </div>
            `;
            
            try {
                const response = await fetch('/api/results/run-evaluations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Error ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                displayEvaluationExecutionResults(result);
            } catch (error) {
                console.error('Error ejecutando evaluaciones:', error);
                showError(`Error al ejecutar evaluaciones: ${error.message}`);
            }
        }
        

        
        function displayLatestResults(evaluationData, testData) {
            const content = document.getElementById('content');
            
            let html = '<div class="latest-results"><h3>√öltimos Resultados</h3>';
            
            // Mostrar √∫ltimos resultados de evaluaciones
            if (evaluationData && evaluationData.length > 0) {
                const latest = evaluationData[0];
                html += `
                    <div class="result-section">
                        <h4>√öltima Evaluaci√≥n</h4>
                        <div class="result-info">
                            <p><strong>Archivo:</strong> ${latest.filename}</p>
                            <p><strong>Fecha:</strong> ${new Date(latest.timestamp).toLocaleString()}</p>
                        </div>
                        <div class="evaluation-summary">
                            ${formatEvaluationSummary(latest.content)}
                        </div>
                    </div>
                `;
            }
            
            // Mostrar informaci√≥n de tests si est√° disponible
            if (testData) {
                html += `
                    <div class="result-section">
                        <h4>Estado de Tests</h4>
                        <div class="test-summary">
                            ${formatTestSummary(testData)}
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            content.innerHTML = html;
        }
        
        function formatEvaluationSummary(content) {
            if (!content) return '<p>No hay datos de evaluaci√≥n disponibles</p>';
            
            let summary = '<div class="evaluation-stats">';
            
            if (content.estadisticas_globales) {
                const stats = content.estadisticas_globales;
                summary += `
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">${stats.total_modelos || 0}</div>
                            <div class="stat-label">Modelos Evaluados</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${stats.modelos_exitosos || 0}</div>
                            <div class="stat-label">Modelos Exitosos</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${stats.modelos_fallidos || 0}</div>
                            <div class="stat-label">Modelos Fallidos</div>
                        </div>
                    </div>
                `;
            }
            
            if (content.comparacion && content.comparacion.ranking) {
                summary += '<div class="ranking"><h4>Top 3 Modelos</h4>';
                content.comparacion.ranking.slice(0, 3).forEach(item => {
                    const emoji = item.posicion === 1 ? '#1' : item.posicion === 2 ? '#2' : '#3';
                    summary += `
                        <div class="ranking-item">
                            <span>${emoji} ${item.modelo}</span>
                            <span class="ranking-score">${item.puntuacion.toFixed(1)}/100</span>
                        </div>
                    `;
                });
                summary += '</div>';
            }
            
            summary += '</div>';
            return summary;
        }
        
        function formatTestSummary(testData) {
            if (!testData) return '<p>No hay datos de tests disponibles</p>';
            
            let html = `
                <div class="test-stats">
                    <div class="test-summary">
                        <h4>Resumen de Tests</h4>
                        <div class="summary-stats">
                            <span class="stat-item">Estado: <span class="status-badge status-${testData.status || 'unknown'}">${testData.status || 'Desconocido'}</span></span>
                            <span class="stat-item">√öltima ejecuci√≥n: ${testData.last_run ? new Date(testData.last_run).toLocaleString() : 'N/A'}</span>
                            <span class="stat-item">Total: ${testData.total_tests || 0}</span>
                            <span class="stat-item">Pasados: <span class="test-count passed">${testData.passed_tests || 0}</span></span>
                            <span class="stat-item">Fallidos: <span class="test-count failed">${testData.failed_tests || 0}</span></span>
                        </div>
                    </div>
            `;
            
            // Mostrar detalles individuales de tests si est√°n disponibles
            if (testData.test_details && testData.test_details.length > 0) {
                html += `
                    <div class="test-details">
                        <h4>Detalles de Tests Individuales</h4>
                        <table class="test-details-table">
                            <thead>
                                <tr>
                                    <th>Nombre del Test</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                testData.test_details.forEach(test => {
                    const statusClass = test.passed ? 'passed' : 'failed';
                    const statusText = test.passed ? 'PAS√ì' : 'FALL√ì';
                    html += `
                        <tr class="test-row ${statusClass}">
                            <td class="test-name">${test.name || 'Test sin nombre'}</td>
                            <td><span class="test-status ${statusClass}">${statusText}</span></td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
            } else {
                html += `
                    <div class="no-details">
                        <p><em>No hay detalles individuales de tests disponibles. Ejecuta los tests para ver informaci√≥n detallada.</em></p>
                    </div>
                `;
            }
            
            html += `</div>`;
            return html;
        }
        

        

        
        function displayCurrentTestStatus(testStatus) {
            let html = `
                <div class="result-card">
                    <div class="result-header">
                        <div class="result-title">Estado Actual de Tests</div>
                        <div class="result-timestamp">${new Date().toLocaleString('es-ES')}</div>
                    </div>
                    
                    <div class="test-summary">
                        <h4>Resumen General</h4>
                        <div class="summary-stats">
                            <span class="stat-item">Estado: <span class="status-badge status-${testStatus.status || 'unknown'}">${testStatus.status || 'Desconocido'}</span></span>
                            <span class="stat-item">√öltima ejecuci√≥n: ${testStatus.last_run ? new Date(testStatus.last_run).toLocaleString('es-ES') : 'N/A'}</span>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">${testStatus.total_tests || 0}</div>
                            <div class="stat-label">Total Tests</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${testStatus.passed_tests || 0}</div>
                            <div class="stat-label">Tests Exitosos</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${testStatus.failed_tests || 0}</div>
                            <div class="stat-label">Tests Fallidos</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${testStatus.skipped_tests || 0}</div>
                            <div class="stat-label">Tests Saltados</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Mostrar estad√≠sticas por categor√≠a
            if (testStatus.categories) {
                html += `
                    <div class="result-card">
                        <h3>Resultados por Categor√≠a</h3>
                        <div class="category-stats">
                `;
                
                Object.entries(testStatus.categories).forEach(([category, stats]) => {
                    if (stats && typeof stats === 'object') {
                        const categoryName = category === 'unit_tests' ? 'Tests Unitarios' : 
                                           category === 'integration_tests' ? 'Tests de Integraci√≥n' : 
                                           category === 'e2e_tests' ? 'Tests E2E' : category;
                        
                        html += `
                            <div class="category-section">
                                <h4>${categoryName}</h4>
                                <div class="category-summary">
                                    <span class="stat-item">Total: ${stats.total || 0}</span>
                                    <span class="stat-item">Pasados: <span class="test-count passed">${stats.passed || 0}</span></span>
                                    <span class="stat-item">Fallidos: <span class="test-count failed">${stats.failed || 0}</span></span>
                                    <span class="stat-item">Saltados: <span class="test-count skipped">${stats.skipped || 0}</span></span>
                                </div>
                            </div>
                        `;
                    }
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            // Organizar tests por funciones/acciones espec√≠ficas
            if (testStatus.test_details && testStatus.test_details.length > 0) {
                const testsByFunction = {
                    'üîê Autenticaci√≥n & Seguridad': [],
                    'üåê APIs & Endpoints': [],
                    'üîç B√∫squeda & RAG': [],
                    'ü§ñ Modelos & IA': [],
                    '‚öôÔ∏è Configuraci√≥n & Settings': [],
                    'üè• Health & Monitoring': [],
                    'üåç Web & Scraping': [],
                    'üîß Utilidades & Core': [],
                    'üìä Tests E2E': [],
                    '‚ùì Otros': []
                };
                
                // Funci√≥n para obtener raz√≥n de skip
                function getSkipReason(test) {
                    const testName = test.name.toLowerCase();
                    const fullName = test.full_name.toLowerCase();
                    
                    if (testName.includes('model_manager') || testName.includes('groq') || fullName.includes('async')) {
                        return '‚ö†Ô∏è Funci√≥n async sin plugin async instalado';
                    }
                    if (testName.includes('api') && fullName.includes('test_api')) {
                        return 'üîë API key real no disponible';
                    }
                    return '‚è≠Ô∏è Test saltado';
                }
                
                // Clasificar tests por funci√≥n/acci√≥n espec√≠fica
                testStatus.test_details.forEach(test => {
                    const testName = test.name.toLowerCase();
                    const fullName = test.full_name.toLowerCase();
                    
                    if (testName.includes('auth') || testName.includes('security') || testName.includes('crypto') || testName.includes('encryption')) {
                        testsByFunction['üîê Autenticaci√≥n & Seguridad'].push(test);
                    } else if (testName.includes('api') || testName.includes('endpoint') || fullName.includes('test_api')) {
                        testsByFunction['üåê APIs & Endpoints'].push(test);
                    } else if (testName.includes('search') || testName.includes('rag') || testName.includes('deepsearch') || testName.includes('query')) {
                        testsByFunction['üîç B√∫squeda & RAG'].push(test);
                    } else if (testName.includes('model') || testName.includes('groq') || testName.includes('competition') || testName.includes('manager')) {
                        testsByFunction['ü§ñ Modelos & IA'].push(test);
                    } else if (testName.includes('settings') || testName.includes('config') || testName.includes('temperature')) {
                        testsByFunction['‚öôÔ∏è Configuraci√≥n & Settings'].push(test);
                    } else if (testName.includes('health') || testName.includes('metrics') || testName.includes('monitoring')) {
                        testsByFunction['üè• Health & Monitoring'].push(test);
                    } else if (testName.includes('web') || testName.includes('scrape') || testName.includes('extract')) {
                        testsByFunction['üåç Web & Scraping'].push(test);
                    } else if (fullName.includes('e2e/')) {
                        testsByFunction['üìä Tests E2E'].push(test);
                    } else if (testName.includes('test_') && (testName.includes('util') || testName.includes('core') || testName.includes('base'))) {
                        testsByFunction['üîß Utilidades & Core'].push(test);
                    } else {
                        testsByFunction['‚ùì Otros'].push(test);
                    }
                });
                
                html += `
                    <div class="result-card">
                        <h3>üìã Tests por Funcionalidad</h3>
                `;
                
                Object.entries(testsByFunction).forEach(([functionName, tests]) => {
                    if (tests.length === 0) return;
                    
                    const passedCount = tests.filter(t => t.passed || t.status === 'PASSED').length;
                    const failedCount = tests.filter(t => !t.passed && t.status !== 'SKIPPED' && t.status !== 'PASSED').length;
                    const skippedCount = tests.filter(t => t.status === 'SKIPPED').length;
                    
                    html += `
                        <div class="category-tests">
                            <h5>${functionName} (${tests.length} tests)</h5>
                            <div class="category-summary">
                                <span class="test-count passed">${passedCount} ‚úÖ</span>
                                <span class="test-count failed">${failedCount} ‚ùå</span>
                                <span class="test-count skipped">${skippedCount} ‚è≠Ô∏è</span>
                            </div>
                            <div class="test-list">
                    `;
                    
                    tests.forEach(test => {
                        const statusIcon = test.status === 'PASSED' || test.passed ? '‚úÖ' : test.status === 'FAILED' || (!test.passed && test.status !== 'SKIPPED') ? '‚ùå' : '‚è≠Ô∏è';
                        const statusClass = test.status === 'SKIPPED' ? 'skipped' : (test.passed || test.status === 'PASSED' ? 'passed' : 'failed');
                        const skipReason = test.status === 'SKIPPED' ? getSkipReason(test) : '';
                        
                        html += `
                            <div class="test-item ${statusClass}">
                                <span class="test-status">${statusIcon}</span>
                                <div class="test-details">
                                    <span class="test-name">${test.name}</span>
                                    <span class="test-full-name" title="${test.full_name || test.name}">${test.full_name || test.name}</span>
                                    ${skipReason ? `<div class="test-skip-reason">${skipReason}</div>` : ''}
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                });
                
                html += `
                    </div>
                `;
            }
            
            document.getElementById('content').innerHTML = html;
        }
        
        function displayTestResults(data) {
            let html = `
                <div class="result-card">
                    <h2>Resultados de Tests del Sistema</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">${data.count}</div>
                            <div class="stat-label">Total Archivos</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Informaci√≥n sobre tipos de tests
            html += `
                <div class="result-card">
                    <h3>Tipos de Tests Disponibles</h3>
                    <div class="ranking">
                        <div class="ranking-item">
                            <div>
                                <strong>Tests Unitarios</strong><br>
                                <small>Pruebas de componentes individuales (API, RAG, Auth, Health)</small>
                            </div>
                        </div>
                        <div class="ranking-item">
                            <div>
                                <strong>Tests de Integraci√≥n</strong><br>
                                <small>Pruebas de interacci√≥n entre componentes (DeepSearch, Model Manager)</small>
                            </div>
                        </div>
                        <div class="ranking-item">
                            <div>
                                <strong>Tests E2E</strong><br>
                                <small>Pruebas de extremo a extremo del sistema completo</small>
                            </div>
                        </div>
                        <div class="ranking-item">
                            <div>
                                <strong>Tests de Competencia</strong><br>
                                <small>Evaluaci√≥n comparativa entre modelos de IA</small>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Comandos para ejecutar tests
            html += `
                <div class="result-card">
                    <h3>Comandos de Ejecuci√≥n</h3>
                    <div class="json-display">
# Ejecutar todos los tests
python run_all_tests.py

# Tests unitarios espec√≠ficos
python -m pytest tests/unit/ -v

# Tests de integraci√≥n
python -m pytest tests/integration/ -v

# Test de competencia de modelos
python tests/integration/test_competition.py

# Evaluaci√≥n autom√°tica
python tests/evaluacion_automatica.py

# Demo de integraci√≥n modular
python scripts/demo_modular_integration.py
                    </div>
                </div>
            `;
            
            document.getElementById('content').innerHTML = html;
        }
        
        async function displayEvaluationResults(data) {
            let html = `
                <div class="result-card">
                    <h2>Resultados de Evaluaciones Autom√°ticas</h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">${data.count}</div>
                            <div class="stat-label">Evaluaciones Realizadas</div>
                        </div>
                    </div>
                </div>
            `;
            
            if (data.files && data.files.length > 0) {
                // Filtrar solo archivos de evaluaci√≥n
                const evaluationFiles = data.files.filter(file => 
                    file.filename.includes('evaluacion_automatica')
                );
                
                // Cargar y mostrar la evaluaci√≥n m√°s reciente
                if (evaluationFiles.length > 0) {
                    try {
                        const latestFile = evaluationFiles[0];
                        const response = await fetch(latestFile.url);
                        const evaluationData = await response.json();
                        
                        html += await generateDetailedEvaluationView(evaluationData);
                    } catch (error) {
                        console.error('Error cargando evaluaci√≥n detallada:', error);
                    }
                }
                
                html += `
                    <div class="result-card">
                        <h3>Historial de Evaluaciones (${evaluationFiles.length} archivos)</h3>
                        <div class="ranking">
                `;
                
                evaluationFiles.slice(0, 10).forEach((file, index) => {
                    const date = new Date(file.modified).toLocaleString('es-ES');
                    const sizeKB = (file.size / 1024).toFixed(1);
                    html += `
                        <div class="ranking-item">
                            <div>
                                <strong>Evaluaci√≥n #${evaluationFiles.length - index}</strong><br>
                                <small>${date} | ${sizeKB} KB</small><br>
                                <small>${file.filename}</small>
                            </div>
                            <button onclick="loadDetailedEvaluation('${file.url}')" class="btn btn-info" style="font-size: 12px; padding: 5px 10px; margin-right: 5px;">Ver Detalles</button>
                            <a href="${file.url}" class="btn btn-primary" style="font-size: 12px; padding: 5px 10px;">Ver JSON</a>
                        </div>
                    `;
                });
                
                html += '</div></div>';
                
                // Informaci√≥n sobre m√©tricas evaluadas
                html += `
                    <div class="result-card">
                        <h3>M√©tricas de Evaluaci√≥n</h3>
                        <div class="ranking">
                            <div class="ranking-item">
                                <div>
                                    <strong>Relevancia</strong><br>
                                    <small>Coincidencia de la respuesta con la consulta</small>
                                </div>
                            </div>
                            <div class="ranking-item">
                                <div>
                                    <strong>Longitud Adecuada</strong><br>
                                    <small>Extensi√≥n apropiada de la respuesta</small>
                                </div>
                            </div>
                            <div class="ranking-item">
                                <div>
                                    <strong>Contenido Informativo</strong><br>
                                    <small>Presencia de informaci√≥n √∫til</small>
                                </div>
                            </div>
                            <div class="ranking-item">
                                <div>
                                    <strong>Creatividad</strong><br>
                                    <small>Originalidad en respuestas creativas</small>
                                </div>
                            </div>
                            <div class="ranking-item">
                                <div>
                                    <strong>C√≥digo</strong><br>
                                    <small>Presencia de c√≥digo en respuestas t√©cnicas</small>
                                </div>
                            </div>
                            <div class="ranking-item">
                                <div>
                                    <strong>Tiempo de Respuesta</strong><br>
                                    <small>Velocidad de generaci√≥n de respuestas</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Categor√≠as de prompts evaluados
                html += `
                    <div class="result-card">
                        <h3>Categor√≠as de Prompts Evaluados</h3>
                        <div class="ranking">
                            <div class="ranking-item">
                                <div>
                                    <strong>Razonamiento</strong><br>
                                    <small>Problemas l√≥gicos y de pensamiento cr√≠tico</small>
                                </div>
                            </div>
                            <div class="ranking-item">
                                <div>
                                    <strong>Conocimiento</strong><br>
                                    <small>Preguntas sobre hechos y informaci√≥n general</small>
                                </div>
                            </div>
                            <div class="ranking-item">
                                <div>
                                    <strong>Programaci√≥n</strong><br>
                                    <small>Consultas t√©cnicas y de desarrollo</small>
                                </div>
                            </div>
                            <div class="ranking-item">
                                <div>
                                    <strong>Creatividad</strong><br>
                                    <small>Tareas creativas y de imaginaci√≥n</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                html += '<div class="result-card"><p>No se encontraron archivos de evaluaci√≥n.</p></div>';
            }
            
            document.getElementById('content').innerHTML = html;
        }
        
        async function generateDetailedEvaluationView(evaluationData) {
            let html = '';
            
            // Resumen general
            html += `
                <div class="result-card">
                    <h3>üìä Resumen de Evaluaci√≥n Detallada</h3>
                    <div class="evaluation-summary">
                        <div class="eval-timestamp">Fecha: ${new Date(evaluationData.timestamp).toLocaleString('es-ES')}</div>
                        <div class="eval-id">ID: ${evaluationData.evaluacion_id}</div>
                    </div>
                </div>
            `;
            
            // Comparaci√≥n de modelos
            if (evaluationData.comparacion && evaluationData.comparacion.ranking) {
                html += `
                    <div class="result-card">
                        <h3>üèÜ Ranking de Modelos</h3>
                        <div class="ranking">
                `;
                
                evaluationData.comparacion.ranking.forEach((modelo, index) => {
                    const emoji = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : 'ü•â';
                    const statusClass = modelo.puntuacion > 70 ? 'success' : modelo.puntuacion > 50 ? 'warning' : 'danger';
                    
                    html += `
                        <div class="ranking-item ${statusClass}">
                            <div class="ranking-position">${emoji} #${modelo.posicion}</div>
                            <div class="ranking-info">
                                <strong>${modelo.modelo.toUpperCase()}</strong>
                                <div class="score">${modelo.puntuacion.toFixed(1)}/100</div>
                            </div>
                            <button onclick="showModelDetails('${modelo.modelo}')" class="btn btn-sm">Ver Detalles</button>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }
            
            // An√°lisis de problemas de Bing
            if (evaluationData.modelos_evaluados.bing) {
                const bingData = evaluationData.modelos_evaluados.bing;
                let errorCount = 0;
                let totalPrompts = 0;
                
                Object.values(bingData.categorias).forEach(categoria => {
                    categoria.prompts.forEach(prompt => {
                        totalPrompts++;
                        if (prompt.respuesta.includes('Error') || prompt.respuesta.includes('401')) {
                            errorCount++;
                        }
                    });
                });
                
                html += `
                    <div class="result-card alert-danger">
                        <h3>‚ö†Ô∏è An√°lisis de Problemas - Bing API</h3>
                        <div class="problem-analysis">
                            <div class="problem-stats">
                                <div class="stat-item">
                                    <div class="stat-value">${errorCount}</div>
                                    <div class="stat-label">Errores 401</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${((errorCount/totalPrompts)*100).toFixed(1)}%</div>
                                    <div class="stat-label">Tasa de Error</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${bingData.resumen.puntuacion_total.toFixed(1)}</div>
                                    <div class="stat-label">Puntuaci√≥n Final</div>
                                </div>
                            </div>
                            <div class="problem-description">
                                <h4>üîç Diagn√≥stico:</h4>
                                <p><strong>Problema Principal:</strong> API Key de Bing inv√°lida o expirada</p>
                                <p><strong>Error HTTP 401:</strong> "Access denied due to invalid subscription key or wrong API endpoint"</p>
                                <p><strong>Impacto:</strong> Todas las consultas de b√∫squeda web fallan, afectando significativamente el rendimiento</p>
                                <p><strong>Soluci√≥n:</strong> Actualizar la API key de Bing en el archivo de configuraci√≥n</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Detalles por categor√≠a
            html += '<div id="detailed-models-view"></div>';
            
            return html;
        }
        
        async function loadDetailedEvaluation(fileUrl) {
            try {
                showLoading('Cargando evaluaci√≥n detallada...');
                const response = await fetch(fileUrl);
                const evaluationData = await response.json();
                
                const detailedHtml = await generateDetailedEvaluationView(evaluationData);
                document.getElementById('content').innerHTML = detailedHtml;
                
                // Guardar datos para funciones posteriores
                window.currentEvaluationData = evaluationData;
                
            } catch (error) {
                console.error('Error cargando evaluaci√≥n:', error);
                showError(`Error al cargar la evaluaci√≥n: ${error.message}`);
            }
        }
        
        function showModelDetails(modelName) {
            if (!window.currentEvaluationData) {
                showError('No hay datos de evaluaci√≥n cargados');
                return;
            }
            
            const modelData = window.currentEvaluationData.modelos_evaluados[modelName];
            if (!modelData) {
                showError(`No se encontraron datos para el modelo ${modelName}`);
                return;
            }
            
            let html = `
                <div class="result-card">
                    <h3>üìã Detalles del Modelo: ${modelName.toUpperCase()}</h3>
                    <div class="model-summary">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">${modelData.resumen.puntuacion_total.toFixed(1)}</div>
                                <div class="stat-label">Puntuaci√≥n Total</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${modelData.resumen.prompts_evaluados}</div>
                                <div class="stat-label">Prompts Evaluados</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">${modelData.resumen.tasa_exito.toFixed(1)}%</div>
                                <div class="stat-label">Tasa de √âxito</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Detalles por categor√≠a
            Object.entries(modelData.categorias).forEach(([categoria, data]) => {
                const statusClass = data.puntuacion_promedio > 70 ? 'success' : data.puntuacion_promedio > 50 ? 'warning' : 'danger';
                
                html += `
                    <div class="result-card">
                        <h4>üìÇ Categor√≠a: ${categoria.charAt(0).toUpperCase() + categoria.slice(1)}</h4>
                        <div class="category-summary ${statusClass}">
                            <div class="category-stats">
                                <span>Promedio: ${data.puntuacion_promedio.toFixed(1)}/100</span>
                                <span>Mejor: ${data.mejor_puntuacion}/100</span>
                                <span>Peor: ${data.peor_puntuacion}/100</span>
                            </div>
                        </div>
                        <div class="prompts-details">
                `;
                
                data.prompts.forEach((prompt, index) => {
                    const promptStatusClass = prompt.puntuacion > 70 ? 'success' : prompt.puntuacion > 50 ? 'warning' : 'danger';
                    const isError = prompt.respuesta.includes('Error') || prompt.respuesta.includes('401');
                    
                    html += `
                        <div class="prompt-item ${promptStatusClass}">
                            <div class="prompt-header">
                                <div class="prompt-title">Prompt ${index + 1}</div>
                                <div class="prompt-score">${prompt.puntuacion}/100</div>
                            </div>
                            <div class="prompt-question">
                                <strong>Pregunta:</strong> ${prompt.prompt}
                            </div>
                            <div class="prompt-response">
                                <strong>Respuesta:</strong>
                                <div class="response-text ${isError ? 'error-response' : ''}">
                                    ${isError ? 
                                        `<span class="error-badge">‚ùå ERROR</span> ${prompt.respuesta}` : 
                                        prompt.respuesta.length > 500 ? 
                                            prompt.respuesta.substring(0, 500) + '...' : 
                                            prompt.respuesta
                                    }
                                </div>
                                ${prompt.respuesta.length > 500 && !isError ? 
                                    `<button onclick="toggleFullResponse(this)" class="btn btn-sm">Ver completa</button>` : 
                                    ''
                                }
                            </div>
                            <div class="prompt-metrics">
                                <div class="metrics-grid">
                                    <div class="metric-item">
                                        <span>Tiempo:</span> ${prompt.tiempo_respuesta.toFixed(2)}s
                                    </div>
                                    <div class="metric-item">
                                        <span>Longitud:</span> ${prompt.longitud_respuesta} chars
                                    </div>
                                </div>
                                <div class="criteria-details">
                                    <strong>Criterios:</strong>
                                    ${Object.entries(prompt.criterios).map(([criterio, valor]) => 
                                        `<span class="criterion ${valor ? 'met' : 'not-met'}">${criterio}: ${valor ? '‚úÖ' : '‚ùå'}</span>`
                                    ).join(' ')}
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div></div>';
            });
            
            html += `
                <div class="result-card">
                    <button onclick="loadEvaluations()" class="btn btn-secondary">‚Üê Volver a Evaluaciones</button>
                </div>
            `;
            
            document.getElementById('content').innerHTML = html;
        }
        
        function toggleFullResponse(button) {
            const responseDiv = button.previousElementSibling;
            const isExpanded = button.textContent === 'Ver menos';
            
            if (isExpanded) {
                // Contraer
                const fullText = responseDiv.getAttribute('data-full-text');
                responseDiv.textContent = fullText.substring(0, 500) + '...';
                button.textContent = 'Ver completa';
            } 
            else {
                // Expandir
                if (!responseDiv.getAttribute('data-full-text')) {
                    responseDiv.setAttribute('data-full-text', responseDiv.textContent);
                }
                const fullText = responseDiv.getAttribute('data-full-text');
                responseDiv.textContent = fullText;
                button.textContent = 'Ver menos';
            }
        }
        
        function displayTestExecutionResults(result) {
            let html = `
                <div class="result-card">
                    <div class="result-header">
                        <div class="result-title">Resultados de Ejecuci√≥n de Tests</div>
                        <div class="result-timestamp">${new Date().toLocaleString('es-ES')}</div>
                    </div>
            `;
            
            if (result.success) {
                html += `
                    <div class="success-message">
                        <h3>Tests ejecutados exitosamente</h3>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">${result.total_tests || 0}</div>
                            <div class="stat-label">Tests Ejecutados</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${result.passed_tests || 0}</div>
                            <div class="stat-label">Tests Exitosos</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${result.failed_tests || 0}</div>
                            <div class="stat-label">Tests Fallidos</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${result.skipped_tests || 0}</div>
                            <div class="stat-label">Tests Saltados</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${result.execution_time || 'N/A'}</div>
                            <div class="stat-label">Tiempo Total</div>
                        </div>
                    </div>
                    
                    <div class="api-status-section">
                        <h4>Estado de APIs</h4>
                        <div class="api-status-grid">
                            <div class="api-status-item" id="groq-status">
                                <div class="api-icon">ü§ñ</div>
                                <div class="api-info">
                                    <div class="api-name">Groq API</div>
                                    <div class="api-status-text">Verificando...</div>
                                </div>
                                <div class="api-indicator">‚è≥</div>
                            </div>
                            <div class="api-status-item" id="bing-status">
                                <div class="api-icon">üîç</div>
                                <div class="api-info">
                                    <div class="api-name">Bing Search API</div>
                                    <div class="api-status-text">Verificando...</div>
                                </div>
                                <div class="api-indicator">‚è≥</div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Mostrar estad√≠sticas por categor√≠a si est√°n disponibles
                if (result.categories) {
                    html += `
                        <div class="result-card">
                            <h3>Resultados por Categor√≠a</h3>
                            <div class="category-stats">
                    `;
                    
                    Object.entries(result.categories).forEach(([category, stats]) => {
                        if (stats && typeof stats === 'object') {
                            const categoryName = category === 'unit_tests' ? 'Tests Unitarios' : 
                                               category === 'integration_tests' ? 'Tests de Integraci√≥n' : 
                                               category === 'e2e_tests' ? 'Tests E2E' : category;
                            
                            html += `
                                <div class="category-section">
                                    <h4>${categoryName}</h4>
                                    <div class="category-summary">
                                        <span class="stat-item">Total: ${stats.total || 0}</span>
                                        <span class="stat-item">Pasados: <span class="test-count passed">${stats.passed || 0}</span></span>
                                        <span class="stat-item">Fallidos: <span class="test-count failed">${stats.failed || 0}</span></span>
                                        <span class="stat-item">Saltados: <span class="test-count skipped">${stats.skipped || 0}</span></span>
                                    </div>
                                </div>
                            `;
                        }
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
                
                if (result.output) {
                    html += `
                        <div class="terminal-output">
                            <h4>Salida de la Terminal:</h4>
                            <pre class="code-block">${result.output}</pre>
                        </div>
                    `;
                }
                
                // Organizar tests por categor√≠as
                if (result.test_details && result.test_details.length > 0) {
                    const testsByCategory = {};
                    
                    result.test_details.forEach(test => {
                        const category = test.category || 'otros';
                        if (!testsByCategory[category]) {
                            testsByCategory[category] = [];
                        }
                        testsByCategory[category].push(test);
                    });
                    
                    html += `<div class="test-details"><h4>Detalles por Categor√≠a:</h4>`;
                    
                    Object.entries(testsByCategory).forEach(([category, tests]) => {
                        const categoryName = category === 'unit_tests' ? 'Tests Unitarios' : 
                                           category === 'integration_tests' ? 'Tests de Integraci√≥n' : 
                                           category === 'e2e_tests' ? 'Tests E2E' : 
                                           category === 'otros' ? 'Otros Tests' : category;
                        
                        const passedCount = tests.filter(t => t.passed).length;
                        const failedCount = tests.filter(t => !t.passed && t.status !== 'SKIPPED').length;
                        const skippedCount = tests.filter(t => t.status === 'SKIPPED').length;
                        
                        html += `
                            <div class="category-tests">
                                <h5>${categoryName} (${tests.length} tests)</h5>
                                <div class="category-summary">
                                    <span class="test-count passed">${passedCount} pasados</span>
                                    <span class="test-count failed">${failedCount} fallidos</span>
                                    <span class="test-count skipped">${skippedCount} saltados</span>
                                </div>
                                <div class="test-list">
                        `;
                        
                        tests.forEach(test => {
                            const status = test.status === 'SKIPPED' ? 'SKIP' : (test.passed ? 'PASS' : 'FAIL');
                            const statusClass = test.status === 'SKIPPED' ? 'skipped' : (test.passed ? 'passed' : 'failed');
                            
                            html += `
                                <div class="test-item ${statusClass}">
                                    <span class="test-status">${status}</span>
                                    <span class="test-name">${test.name}</span>
                                    <span class="test-time">${test.time || 'N/A'}</span>
                                </div>
                            `;
                        });
                        
                        html += `
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                }
            } else {
                html += `
                    <div class="error-message">
                        <h3>ERROR: Fall√≥ la ejecuci√≥n de tests</h3>
                        <p>${result.error || 'Error desconocido'}</p>
                    </div>
                `;
                
                if (result.output) {
                    html += `
                        <div class="terminal-output">
                            <h4>Salida de Error:</h4>
                            <pre class="code-block error">${result.output}</pre>
                        </div>
                    `;
                }
            }
            
            html += `</div>`;
            document.getElementById('content').innerHTML = html;
        }
        
        function displayEvaluationExecutionResults(result) {
            let html = `
                <div class="result-card">
                    <div class="result-header">
                        <div class="result-title">Resultados de Ejecuci√≥n de Evaluaciones</div>
                        <div class="result-timestamp">${new Date().toLocaleString('es-ES')}</div>
                    </div>
            `;
            
            if (result.success) {
                html += `
                    <div class="success-message">
                        <h3>Evaluaciones ejecutadas exitosamente</h3>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">${result.total_evaluations || 0}</div>
                            <div class="stat-label">Evaluaciones</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${result.successful_evaluations || 0}</div>
                            <div class="stat-label">Exitosas</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${result.failed_evaluations || 0}</div>
                            <div class="stat-label">Fallidas</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${result.execution_time || 'N/A'}</div>
                            <div class="stat-label">Tiempo Total</div>
                        </div>
                    </div>
                `;
                
                if (result.evaluation_data) {
                    html += `
                        <div class="evaluation-details">
                            <h4>Datos de Evaluaci√≥n Completos:</h4>
                            <div class="json-viewer">${JSON.stringify(result.evaluation_data, null, 2)}</div>
                        </div>
                    `;
                }
                
                if (result.output) {
                    html += `
                         <div class="terminal-output">
                             <h4>Salida de la Terminal:</h4>
                             <pre class="code-block">${result.output}</pre>
                         </div>
                     `;
                }
            } else {
                html += `
                    <div class="error-message">
                        <h3>ERROR: Fall√≥ la ejecuci√≥n de evaluaciones</h3>
                        <p>${result.error || 'Error desconocido'}</p>
                    </div>
                `;
                
                if (result.output) {
                    html += `
                         <div class="terminal-output">
                             <h4>Salida de Error:</h4>
                             <pre class="code-block error">${result.output}</pre>
                         </div>
                     `;
                }
            }
            
            html += `</div>`;
            document.getElementById('content').innerHTML = html;
        }
        
        function refreshData() {
            if (!autoRefreshEnabled) return;
            
            switch(currentView) {
                case 'latest':
                    loadLatestResults();
                    break;
                case 'tests':
                    loadTests();
                    break;
                case 'evaluations':
                    loadEvaluations();
                    break;
                default:
                    loadLatestResults();
            }
        }
        
        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const btn = document.getElementById('autoRefreshBtn');
            
            if (autoRefreshEnabled) {
                btn.textContent = 'Pausar Auto-Refresh';
                btn.className = 'btn btn-warning';
                console.log('Auto-refresh habilitado');
            } else {
                btn.textContent = 'Activar Auto-Refresh';
                btn.className = 'btn btn-success';
                console.log('Auto-refresh pausado');
            }
        }
        
        // Funci√≥n para verificar el estado de las APIs
        async function checkAPIStatus() {
            // Verificar Groq API
            try {
                const groqResponse = await fetch('/health/groq');
                const groqData = await groqResponse.json();
                updateAPIStatus('groq-status', groqData.status === 'working', groqData.message || 'API funcionando correctamente');
            } catch (error) {
                updateAPIStatus('groq-status', false, 'Error al verificar API');
            }
            
            // Verificar Bing Search API
            try {
                const bingResponse = await fetch('/health/bing');
                const bingData = await bingResponse.json();
                updateAPIStatus('bing-status', bingData.status === 'working', bingData.message || 'API funcionando correctamente');
            } catch (error) {
                updateAPIStatus('bing-status', false, 'Error al verificar API');
            }
        }
        
        // Funci√≥n para actualizar el estado visual de una API
        function updateAPIStatus(elementId, isWorking, message) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const statusText = element.querySelector('.api-status-text');
            const indicator = element.querySelector('.api-indicator');
            
            // Remover clases anteriores
            element.classList.remove('working', 'error', 'checking');
            
            if (isWorking) {
                element.classList.add('working');
                statusText.textContent = message;
                indicator.textContent = '‚úÖ';
            } else {
                element.classList.add('error');
                statusText.textContent = message;
                indicator.textContent = '‚ùå';
            }
        }
        
        // Cargar datos iniciales
        document.addEventListener('DOMContentLoaded', function() {
            loadLatestResults();
            // Verificar estado de APIs al cargar la p√°gina
            setTimeout(checkAPIStatus, 1000);
        });
        
        // Auto-refresh cada 2 minutos (120 segundos) para evitar recargas frecuentes
        autoRefreshInterval = setInterval(refreshData, 120000);
    </script>
</body>
</html>